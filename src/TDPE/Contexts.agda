module TDPE.Contexts {â„“} (ğ’¯ : Set â„“) where

open import Level

infixl 4 _Â·_

data ğ’ : Set â„“ where
  ğŸ™   : ğ’
  _Â·_ : ğ’ â†’ ğ’¯ â†’ ğ’

[_] = Î» A â†’ ğŸ™ Â· A

_âŠ•_ : ğ’ â†’ ğ’ â†’ ğ’
Î“ âŠ• ğŸ™       = Î“
Î“ âŠ• (Î” Â· A) = (Î“ âŠ• Î”) Â· A

data ğ’² : ğ’ â†’ ğ’ â†’ Set â„“ where
  Ïµâ‚€ : ğ’² ğŸ™ ğŸ™
  Ï‰â‚ : âˆ€ {Î“ Î” A} â†’ ğ’² Î“ Î” â†’ ğ’² (Î“ Â· A) Î”
  Ï‰â‚‚ : âˆ€ {Î“ Î” A} â†’ ğ’² Î“ Î” â†’ ğ’² (Î“ Â· A) (Î” Â· A)

_âˆ˜_ : âˆ€ {Î“â‚ Î“â‚‚ Î“â‚ƒ} â†’ ğ’² Î“â‚ Î“â‚‚ â†’ ğ’² Î“â‚‚ Î“â‚ƒ â†’ ğ’² Î“â‚ Î“â‚ƒ
Ïµâ‚€   âˆ˜ w'    = w'
Ï‰â‚ w âˆ˜ w'    = Ï‰â‚ (w âˆ˜ w')
Ï‰â‚‚ w âˆ˜ Ï‰â‚ w' = Ï‰â‚ (w âˆ˜ w')
Ï‰â‚‚ w âˆ˜ Ï‰â‚‚ w' = Ï‰â‚‚ (w âˆ˜ w')

Ïµ : âˆ€ {Î“} â†’ ğ’² Î“ Î“
Ïµ {ğŸ™}     = Ïµâ‚€
Ïµ {_ Â· _} = Ï‰â‚‚ Ïµ

ğ’²+ : âˆ€ {a} (ğ“Ÿ : ğ’ â†’ Set a) â†’ Set (â„“ âŠ” a)
ğ’²+ ğ“Ÿ = âˆ€ {Î“ Î”} â†’ ğ’² Î“ Î” â†’ ğ“Ÿ Î” â†’ ğ“Ÿ Î“

data âŸ¨_âŸ© {a} (ğ’ª : ğ’¯ â†’ Set a) : ğ’ â†’ Set a where
  !     : âŸ¨ ğ’ª âŸ© ğŸ™
  âŸ¨_âˆ·_âŸ© : âˆ€ {Î“ A} â†’ âŸ¨ ğ’ª âŸ© Î“ â†’ ğ’ª A â†’ âŸ¨ ğ’ª âŸ© (Î“ Â· A)

ğ“© : âˆ€ {a} {ğ’ª : ğ’¯ â†’ Set a} {Î“ A} â†’ âŸ¨ ğ’ª âŸ© (Î“ Â· A) â†’ ğ’ª A
ğ“© âŸ¨ _ âˆ· a âŸ© = a

âŸ¨+âŸ© : âˆ€ {a} {ğ’ª : ğ’ â†’ ğ’¯ â†’ Set a}
      â†’ (âˆ€ A â†’ ğ’²+ (Î» Î” â†’ ğ’ª Î” A))
      â†’ (âˆ€ Î“ â†’ ğ’²+ (Î» Î” â†’ âŸ¨ ğ’ª Î” âŸ© Î“))
âŸ¨+âŸ© {ğ’ª = ğ’ª} + Î“ w x = I Î“ x
  where I : âˆ€ Î“ â†’ âŸ¨ ğ’ª _ âŸ© Î“ â†’ âŸ¨ ğ’ª _ âŸ© Î“
        I ğŸ™       !         = !
        I (Î“ Â· A) âŸ¨ Î³ âˆ· a âŸ© = âŸ¨ I Î“ Î³ âˆ· + A w a âŸ©
