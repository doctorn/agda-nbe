{-# OPTIONS --without-K --safe #-}

module TDPE.Gluing.Syntax {a} (ğ’° : Set a) where

open import Level

open import TDPE.Gluing.Contexts ğ’°
import TDPE.Gluing.Util.Equivalence as E

open import Categories.Category using (Category)

infixl 8 _âˆ·_
infixl 9 _âˆ˜_
infix 4 _â†¦â‚€_ _â†¦_

private
  variable
    Î“ Î” Î Î© : â„­
    A B C : ğ’°áµ€

mutual
  data ğ”—ğ”ªâ‚€ : â„­ â†’ ğ’°áµ€ â†’ Set a where
    -- variables
    ğ“     : ğ”—ğ”ªâ‚€ (Î“ Â· A) A
    p     : ğ”—ğ”ªâ‚€ Î“ B â†’ ğ”—ğ”ªâ‚€ (Î“ Â· A) B
    -- exponentials
    Î›     : ğ”—ğ”ªâ‚€ (Î“ Â· A) B â†’ ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)
    _â¦…_â¦†  : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B) â†’ ğ”—ğ”ªâ‚€ Î“ A â†’ ğ”—ğ”ªâ‚€ Î“ B
    -- substitution
    _[_] : ğ”—ğ”ªâ‚€ Î“ A â†’ ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ªâ‚€ Î” A

  data ğ”—ğ”ª : â„­ â†’ â„­ â†’ Set a where
    !   : ğ”—ğ”ª Î“ ğŸ™
    _âˆ·_ : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ªâ‚€ Î” A â†’ ğ”—ğ”ª Î” (Î“ Â· A)

Ï€ : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ª (Î” Â· A) Î“
Ï€ !       = !
Ï€ (Î³ âˆ· a) = Ï€ Î³ âˆ· p a

-- syntactic substitution
_âˆ˜_ : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ª Î Î” â†’ ğ”—ğ”ª Î Î“
!       âˆ˜ Î´ = !
(Î³ âˆ· a) âˆ˜ Î´ = (Î³ âˆ˜ Î´) âˆ· (a [ Î´ ])

-- de bruijin lifiting
â†‘[_] : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ª (Î” Â· A) (Î“ Â· A)
â†‘[ Î³ ] = Ï€ Î³ âˆ· ğ“

id : âˆ€ {Î“} â†’ ğ”—ğ”ª Î“ Î“
id {ğŸ™}     = !
id {Î“ Â· A} = â†‘[ id ]

-- singleton
âŸ¨_âŸ© : ğ”—ğ”ªâ‚€ Î“ A â†’ ğ”—ğ”ª Î“ (ğŸ™ Â· A)
âŸ¨_âŸ© = ! âˆ·_

mutual
  data _â†¦â‚€_ : ğ”—ğ”ªâ‚€ Î“ A â†’ ğ”—ğ”ªâ‚€ Î“ A â†’ Set a where
    Î›Î²â‚€ : âˆ€ {f : ğ”—ğ”ªâ‚€ (Î“ Â· A) B} {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ (Î› f) â¦… x â¦† â†¦â‚€ f [ id âˆ· x ]
    Î›Î·â‚€ : âˆ€ {f : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} â†’ f â†¦â‚€ Î› ((f [ Ï€ id ]) â¦… ğ“ â¦†)
    vğ“â‚€ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ (ğ“ [ Î³ âˆ· a ]) â†¦â‚€ a
    vpâ‚€ : âˆ€ {t : ğ”—ğ”ªâ‚€ Î“ B} {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ (p t) [ Î³ âˆ· a ] â†¦â‚€ t [ Î³ ]

    p-step : âˆ€ {s t : ğ”—ğ”ªâ‚€ Î“ B} {A} â†’ s â†¦â‚€ t â†’ p {A = A} s â†¦â‚€ p {A = A} t
    app-stepâ‚— : âˆ€ {f g : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ f â†¦â‚€ g â†’ f â¦… x â¦† â†¦â‚€ g â¦… x â¦†
    app-stepáµ£ : âˆ€ {f : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} {x y : ğ”—ğ”ªâ‚€ Î“ A} â†’ x â†¦â‚€ y â†’ f â¦… x â¦† â†¦â‚€ f â¦… y â¦†
    Î›-step    : âˆ€ {f g : ğ”—ğ”ªâ‚€ (Î“ Â· A) B} â†’ f â†¦â‚€ g â†’ Î› f â†¦â‚€ Î› g
    sb-stepâ‚—  : âˆ€ {s t : ğ”—ğ”ªâ‚€ Î“ A} {Î³ : ğ”—ğ”ª Î” Î“} â†’ s â†¦â‚€ t â†’ s [ Î³ ] â†¦â‚€ t [ Î³ ]
    sb-stepáµ£  : âˆ€ {t : ğ”—ğ”ªâ‚€ Î“ A} {Î³ Î´ : ğ”—ğ”ª Î” Î“} â†’ Î³ â†¦ Î´ â†’ t [ Î³ ] â†¦â‚€ t [ Î´ ]

    p-Ï€â‚€ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ Î“ A} â†’ p {A = B} (f [ Î³ ]) â†¦â‚€ f [ Ï€ {A = B} Î³ ]

    sb-idâ‚€    : âˆ€ {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ x [ id {Î“} ] â†¦â‚€ x
    sb-appâ‚€   : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ (f â¦… x â¦†) [ Î³ ] â†¦â‚€ (f [ Î³ ]) â¦… x [ Î³ ] â¦†
    sb-lamâ‚€   : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ (Î“ Â· A) B} â†’ (Î› f) [ Î³ ] â†¦â‚€ Î› (f [ â†‘[ Î³ ] ])
    sb-assocâ‚€ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”} {t : ğ”—ğ”ªâ‚€ Î“ A} â†’ (t [ Î³ ]) [ Î´ ] â†¦â‚€ t [ Î³ âˆ˜ Î´ ]

  data _â†¦_ : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ª Î” Î“ â†’ Set a where
    !Î·â‚€     : âˆ€ {Î³ : ğ”—ğ”ª Î“ ğŸ™} â†’ Î³ â†¦ !
    âˆ·-stepâ‚— : âˆ€ {Î³ Î´ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ Î³ â†¦ Î´ â†’ (Î³ âˆ· a) â†¦ (Î´ âˆ· a)
    âˆ·-stepáµ£ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a b : ğ”—ğ”ªâ‚€ Î” A} â†’ a â†¦â‚€ b â†’ (Î³ âˆ· a) â†¦ (Î³ âˆ· b)

-- equivalence on clone
module _ {Î“ A} where
  module C = E (_â†¦â‚€_ {Î“} {A})

-- equivalence on substitutions
module _ {Î” Î“} where
  module S = E (_â†¦_ {Î”} {Î“})

ğ’µ : ğ”—ğ”ª Î” (Î“ Â· A) â†’ ğ”—ğ”ªâ‚€ Î” A
ğ’µ (_ âˆ· a) = a

ğ’µ-cong : âˆ€ {Î” Î“ A} {Î³ Î´ : ğ”—ğ”ª Î” (Î“ Â· A)} â†’ Î³ S.â‰ˆ Î´ â†’ ğ’µ Î³ C.â‰ˆ ğ’µ Î´
ğ’µ-cong = S.induct C.is-equiv ğ’µ I
  where I : {Î³ Î´ : ğ”—ğ”ª Î” (Î“ Â· A)} â†’ Î³ â†¦ Î´ â†’ ğ’µ Î³ C.â‰ˆ ğ’µ Î´
        I (âˆ·-stepâ‚— x) = C.refl
        I (âˆ·-stepáµ£ x) = C.unit x

Î›Î² : âˆ€ {f : ğ”—ğ”ªâ‚€ (Î“ Â· A) B} {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ (Î› f) â¦… x â¦† C.â‰ˆ f [ id âˆ· x ]
Î›Î² = C.unit Î›Î²â‚€

Î›Î· : âˆ€ {f : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} â†’ f C.â‰ˆ Î› ((f [ Ï€ id ]) â¦… ğ“ â¦†)
Î›Î· = C.unit Î›Î·â‚€

vğ“ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ (ğ“ [ Î³ âˆ· a ]) C.â‰ˆ a
vğ“ = C.unit vğ“â‚€

vğ’µ : âˆ€ {Î³ : ğ”—ğ”ª Î” (Î“ Â· A)} â†’ (ğ“ [ Î³ ]) C.â‰ˆ ğ’µ Î³
vğ’µ {Î³ = _ âˆ· _} = C.unit vğ“â‚€

ğ’µÎ· : âˆ€ {Î³ : ğ”—ğ”ª Î” (ğŸ™ Â· A)} â†’ ! âˆ· ğ’µ Î³ S.â‰ˆ Î³
ğ’µÎ· {Î³ = ! âˆ· _} = S.refl

ğ’µp : âˆ€ {Î³ : ğ”—ğ”ª Î” (ğŸ™ Â· A)} â†’ p {A = B} (ğ’µ Î³) C.â‰ˆ ğ“ [ Ï€ Î³ ]
ğ’µp {Î³ = ! âˆ· _} = C.sym vğ“

vp : âˆ€ {t : ğ”—ğ”ªâ‚€ Î“ B} {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ (p t) [ Î³ âˆ· a ] C.â‰ˆ t [ Î³ ]
vp = C.unit vpâ‚€

p-Ï€ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ Î“ A} â†’ p {A = B} (f [ Î³ ]) C.â‰ˆ f [ Ï€ {A = B} Î³ ]
p-Ï€ = C.unit p-Ï€â‚€

sb-id : âˆ€ {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ x [ id {Î“} ] C.â‰ˆ x
sb-id = C.unit sb-idâ‚€

sb-app : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ Î“ (A â‡’ B)} {x : ğ”—ğ”ªâ‚€ Î“ A} â†’ (f â¦… x â¦†) [ Î³ ] C.â‰ˆ (f [ Î³ ]) â¦… x [ Î³ ] â¦†
sb-app = C.unit sb-appâ‚€

sb-lam : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {f : ğ”—ğ”ªâ‚€ (Î“ Â· A) B} â†’ (Î› f) [ Î³ ] C.â‰ˆ Î› (f [ â†‘[ Î³ ] ])
sb-lam = C.unit sb-lamâ‚€

sb-comp : âˆ€ {Î³ : ğ”—ğ”ª Î” (Î“ Â· A)} {Î´ : ğ”—ğ”ª Î Î”} â†’ ğ’µ Î³ [ Î´ ] C.â‰ˆ ğ’µ (Î³ âˆ˜ Î´)
sb-comp {Î³ = _ âˆ· _} = C.refl

sb-assoc : âˆ€ {Î´ : ğ”—ğ”ª Î” Î“} {Î³ : ğ”—ğ”ª Î Î”} {t : ğ”—ğ”ªâ‚€ Î“ A} â†’ (t [ Î´ ]) [ Î³ ] C.â‰ˆ t [ Î´ âˆ˜ Î³ ]
sb-assoc = C.unit sb-assocâ‚€

!Î· : âˆ€ {Î³ : ğ”—ğ”ª Î“ ğŸ™} â†’ Î³ S.â‰ˆ !
!Î· = S.unit !Î·â‚€

âˆ·-congáµ£ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a b : ğ”—ğ”ªâ‚€ Î” A} â†’ a C.â‰ˆ b â†’ Î³ âˆ· a S.â‰ˆ Î³ âˆ· b
âˆ·-congáµ£ = C.induct S.is-equiv (_ âˆ·_) (Î» x â†’ S.unit (âˆ·-stepáµ£ x))

âˆ·-congâ‚— : âˆ€ {Î³ Î´ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î” A} â†’ Î³ S.â‰ˆ Î´ â†’ Î³ âˆ· a S.â‰ˆ Î´ âˆ· a
âˆ·-congâ‚— = S.induct S.is-equiv (_âˆ· _) Î» x â†’ S.unit (âˆ·-stepâ‚— x)

âˆ·-congâ‚‚ : âˆ€ {Î³ Î´ : ğ”—ğ”ª Î” Î“} {a b : ğ”—ğ”ªâ‚€ Î” A} â†’ Î³ S.â‰ˆ Î´ â†’ a C.â‰ˆ b â†’ Î³ âˆ· a S.â‰ˆ Î´ âˆ· b
âˆ·-congâ‚‚ x y = S.trans (âˆ·-congâ‚— x) (âˆ·-congáµ£ y)

ğ“Î· : âˆ€ {Î³ : ğ”—ğ”ª Î” (ğŸ™ Â· A)} â†’ ! âˆ· ğ“ [ Î³ ] S.â‰ˆ Î³
ğ“Î· {Î³ = ! âˆ· _} = âˆ·-congáµ£ vğ“

Î›-cong : âˆ€ {s t : ğ”—ğ”ªâ‚€ (Î” Â· A) B} â†’ s C.â‰ˆ t â†’ Î› s C.â‰ˆ Î› t
Î›-cong = C.induct C.is-equiv Î› Î» x â†’ C.unit (Î›-step x)

app-congâ‚— : âˆ€ {f g : ğ”—ğ”ªâ‚€ Î” (A â‡’ B)} {x : ğ”—ğ”ªâ‚€ Î” A} â†’ f C.â‰ˆ g â†’ f â¦… x â¦† C.â‰ˆ g â¦… x â¦†
app-congâ‚— = C.induct C.is-equiv (_â¦… _ â¦†) Î» x â†’ C.unit (app-stepâ‚— x)

app-congáµ£ : âˆ€ {f : ğ”—ğ”ªâ‚€ Î” (A â‡’ B)} {x y : ğ”—ğ”ªâ‚€ Î” A} â†’ x C.â‰ˆ y â†’ f â¦… x â¦† C.â‰ˆ f â¦… y â¦†
app-congáµ£ = C.induct C.is-equiv (_ â¦…_â¦†) Î» x â†’ C.unit (app-stepáµ£ x)

app-congâ‚‚ : âˆ€ {f g : ğ”—ğ”ªâ‚€ Î” (A â‡’ B)} {x y : ğ”—ğ”ªâ‚€ Î” A} â†’ f C.â‰ˆ g â†’ x C.â‰ˆ y â†’ f â¦… x â¦† C.â‰ˆ g â¦… y â¦†
app-congâ‚‚ x y = C.trans (app-congâ‚— x) (app-congáµ£ y)

sb-congâ‚— : âˆ€ {s t : ğ”—ğ”ªâ‚€ Î“ A} {Î³ : ğ”—ğ”ª Î” Î“} â†’ s C.â‰ˆ t â†’ s [ Î³ ] C.â‰ˆ t [ Î³ ]
sb-congâ‚— = C.induct C.is-equiv (_[ _ ]) Î» x â†’ C.unit (sb-stepâ‚— x)

sb-congáµ£ : âˆ€ {t : ğ”—ğ”ªâ‚€ Î“ A} {Î³ Î´ : ğ”—ğ”ª Î” Î“} â†’ Î³ S.â‰ˆ Î´ â†’ t [ Î³ ] C.â‰ˆ t [ Î´ ]
sb-congáµ£ = S.induct C.is-equiv (_ [_]) Î» x â†’ C.unit (sb-stepáµ£ x)

sb-congâ‚‚ : âˆ€ {s t : ğ”—ğ”ªâ‚€ Î“ A} {Î³ Î´ : ğ”—ğ”ª Î” Î“} â†’ s C.â‰ˆ t â†’ Î³ S.â‰ˆ Î´ â†’ s [ Î³ ] C.â‰ˆ t [ Î´ ]
sb-congâ‚‚ x y = C.trans (sb-congâ‚— x) (sb-congáµ£ y)

p-cong : âˆ€ {s t : ğ”—ğ”ªâ‚€ Î” B} {A} â†’ s C.â‰ˆ t â†’ p {A = A} s C.â‰ˆ p {A = A} t
p-cong = C.induct C.is-equiv p Î» x â†’ C.unit (p-step x)

project : âˆ€ {Î³ Î´ : ğ”—ğ”ª Î” Î“} {a b : ğ”—ğ”ªâ‚€ Î” A} â†’ Î³ âˆ· a S.â‰ˆ Î´ âˆ· b â†’ Î³ S.â‰ˆ Î´
project = S.induct S.is-equiv (Î» { (Î³ âˆ· _) â†’ Î³ }) Î» { (âˆ·-stepâ‚— x) â†’ S.unit x ; (âˆ·-stepáµ£ x) â†’ S.refl }

Ï€Î² : âˆ€ {Î“} {Î´ : ğ”—ğ”ª Î Î”} {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ªâ‚€ Î A} â†’ Ï€ Î³ âˆ˜ (Î´ âˆ· a) S.â‰ˆ Î³ âˆ˜ Î´
Ï€Î² {Î“ = ğŸ™}     {Î³ = !}     = S.refl
Ï€Î² {Î“ = Î“ Â· B} {Î³ = Î³ âˆ· b} = âˆ·-congâ‚‚ Ï€Î² vp

Ï€-lemma : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”} â†’ Î³ âˆ˜ Ï€ Î´ S.â‰ˆ Ï€ {A = A} (Î³ âˆ˜ Î´)
Ï€-lemma {Î³ = !}     = !Î·
Ï€-lemma {Î³ = Î³ âˆ· a} = âˆ·-congâ‚‚ Ï€-lemma (C.sym p-Ï€)

Ï€-cong : âˆ€ {Î³ Î´ : ğ”—ğ”ª Î” Î“} â†’ Î³ S.â‰ˆ Î´ â†’ Ï€ Î³ S.â‰ˆ Ï€ {A = A} Î´
Ï€-cong {Î³ = !}     {Î´ = !}     _ = !Î·
Ï€-cong {Î³ = Î³ âˆ· x} {Î´ = Î´ âˆ· y} q = âˆ·-congâ‚‚ (Ï€-cong (project q)) (p-cong (ğ’µ-cong q))

âˆ˜-identityË¡ : âˆ€ {Î“} {Î³ : ğ”—ğ”ª Î” Î“} â†’ id âˆ˜ Î³ S.â‰ˆ Î³
âˆ˜-identityË¡ {Î“ = ğŸ™}     {Î³ = !} = S.refl
âˆ˜-identityË¡ {Î“ = Î“ Â· A} {Î³ âˆ· a} = âˆ·-congâ‚‚ (S.trans Ï€Î² âˆ˜-identityË¡) vğ“

âˆ˜-identityÊ³ : âˆ€ {Î“} {Î³ : ğ”—ğ”ª Î” Î“} â†’ Î³ âˆ˜ id S.â‰ˆ Î³
âˆ˜-identityÊ³ {Î“ = ğŸ™}     {Î³ = !}     = S.refl
âˆ˜-identityÊ³ {Î“ = Î“ Â· A} {Î³ = Î³ âˆ· a} = âˆ·-congâ‚‚ âˆ˜-identityÊ³ sb-id

âˆ˜-identityÂ² : âˆ€ {Î“} â†’ id âˆ˜ id S.â‰ˆ id {Î“}
âˆ˜-identityÂ² {Î“ = ğŸ™}     = S.refl
âˆ˜-identityÂ² {Î“ = Î“ Â· A} = âˆ·-congâ‚‚ (S.trans Ï€Î² âˆ˜-identityË¡) vğ“

âˆ˜-assoc : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”} {Î¶ : ğ”—ğ”ª Î© Î}
          â†’ (Î³ âˆ˜ Î´) âˆ˜ Î¶ S.â‰ˆ Î³ âˆ˜ (Î´ âˆ˜ Î¶)
âˆ˜-assoc {Î³ = !}     {Î´} {Î¶} = S.refl
âˆ˜-assoc {Î³ = Î³ âˆ· x} {Î´} {Î¶} = âˆ·-congâ‚‚ âˆ˜-assoc sb-assoc

âˆ˜-sym-assoc : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”} {Î¶ : ğ”—ğ”ª Î© Î}
              â†’ Î³ âˆ˜ (Î´ âˆ˜ Î¶) S.â‰ˆ (Î³ âˆ˜ Î´) âˆ˜ Î¶
âˆ˜-sym-assoc = S.sym âˆ˜-assoc

âˆ˜-stepâ‚— : âˆ€ {Î³ Î³' : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”} â†’ Î³ â†¦ Î³' â†’ Î³ âˆ˜ Î´ S.â‰ˆ Î³' âˆ˜ Î´
âˆ˜-stepâ‚— !Î·â‚€         = !Î·
âˆ˜-stepâ‚— (âˆ·-stepâ‚— x) = âˆ·-congâ‚— (âˆ˜-stepâ‚— x)
âˆ˜-stepâ‚— (âˆ·-stepáµ£ x) = âˆ·-congáµ£ (C.unit (sb-stepâ‚— x))

âˆ˜-stepáµ£ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ Î´' : ğ”—ğ”ª Î Î”} â†’ Î´ â†¦ Î´' â†’ Î³ âˆ˜ Î´ S.â‰ˆ Î³ âˆ˜ Î´'
âˆ˜-stepáµ£ {Î³ = !}             _   = S.refl
âˆ˜-stepáµ£ {Î³ = Î³ âˆ· a} {Î´ = !} !Î·â‚€ = S.refl
âˆ˜-stepáµ£ {Î³ = Î³ âˆ· a}         q   = âˆ·-congâ‚‚ (âˆ˜-stepáµ£ q) (C.unit (sb-stepáµ£ q))

âˆ˜-congâ‚— : âˆ€ {Î³ Î³' : ğ”—ğ”ª Î” Î“} {Î´ : ğ”—ğ”ª Î Î”}
          â†’ Î³ S.â‰ˆ Î³' â†’ Î³ âˆ˜ Î´ S.â‰ˆ Î³' âˆ˜ Î´
âˆ˜-congâ‚— = S.induct S.is-equiv (_âˆ˜ _) âˆ˜-stepâ‚—

âˆ˜-congáµ£ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {Î´ Î´' : ğ”—ğ”ª Î Î”}
          â†’ Î´ S.â‰ˆ Î´' â†’ Î³ âˆ˜ Î´ S.â‰ˆ Î³ âˆ˜ Î´'
âˆ˜-congáµ£ = S.induct S.is-equiv (_ âˆ˜_) âˆ˜-stepáµ£

âˆ˜-resp-â‰ˆ : âˆ€ {Î Î” Î“} {Î³ Î³' : ğ”—ğ”ª Î” Î“} {Î´ Î´' : ğ”—ğ”ª Î Î”}
           â†’ Î³ S.â‰ˆ Î³' â†’ Î´ S.â‰ˆ Î´' â†’ Î³ âˆ˜ Î´ S.â‰ˆ Î³' âˆ˜ Î´'
âˆ˜-resp-â‰ˆ x y = S.trans (âˆ˜-congâ‚— x) (âˆ˜-congáµ£ y)

Ï€-id : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} â†’ Î³ âˆ˜ Ï€ id S.â‰ˆ Ï€ {A = A} Î³
Ï€-id = S.trans Ï€-lemma (Ï€-cong âˆ˜-identityÊ³)

Ï€Î²â€² : âˆ€ {Î´ : ğ”—ğ”ª Î Î”} {a : ğ”—ğ”ªâ‚€ Î A} â†’ Ï€ id âˆ˜ (Î´ âˆ· a) S.â‰ˆ Î´
Ï€Î²â€² = S.trans Ï€Î² âˆ˜-identityË¡

ğ•‹ğ• : Category a a a
ğ•‹ğ• = record
  { Obj = â„­
  ; _â‡’_ = ğ”—ğ”ª
  ; _â‰ˆ_ = S._â‰ˆ_
  ; id = id
  ; _âˆ˜_ = _âˆ˜_
  ; assoc = âˆ˜-assoc
  ; sym-assoc = âˆ˜-sym-assoc
  ; identityË¡ = âˆ˜-identityË¡
  ; identityÊ³ = âˆ˜-identityÊ³
  ; identityÂ² = âˆ˜-identityÂ²
  ; equiv = S.is-equiv
  ; âˆ˜-resp-â‰ˆ = âˆ˜-resp-â‰ˆ
  }

open import TDPE.Gluing.Categories.Category.ContextualCartesian ğ•‹ğ•
open import TDPE.Gluing.Categories.Category.ContextualCartesianClosed ğ•‹ğ•

CC : ContextualCartesian ğ’°áµ€
CC = record
  { terminal = record
    { âŠ¤ = ğŸ™
    ; âŠ¤-is-terminal = record
      { ! = !
      ; !-unique = Î» f â†’ S.sym !Î·
      }
    }
  ; _Â·_ = _Â·_
  ; Ï€ = Ï€ id
  ; ğ“ = ! âˆ· ğ“
  ; extensions = record
    { âŸ¨_,_âŸ© = âŸ¨_,_âŸ©
    ; projectâ‚ = projectâ‚
    ; projectâ‚‚ = projectâ‚‚
    ; unique = unique
    }
  }
  where âŸ¨_,_âŸ© : ğ”—ğ”ª Î” Î“ â†’ ğ”—ğ”ª Î” (ğŸ™ Â· A) â†’ ğ”—ğ”ª Î” (Î“ Â· A)
        âŸ¨ Î³ , ! âˆ· a âŸ© = Î³ âˆ· a

        projectâ‚ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ª Î” (ğŸ™ Â· A)} â†’ Ï€ id âˆ˜ âŸ¨ Î³ , a âŸ© S.â‰ˆ Î³
        projectâ‚ {a = ! âˆ· a} = S.trans Ï€Î² âˆ˜-identityË¡

        projectâ‚‚ : âˆ€ {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ª Î” (ğŸ™ Â· A)} â†’ (! âˆ· ğ“) âˆ˜ âŸ¨ Î³ , a âŸ© S.â‰ˆ a
        projectâ‚‚ {a = ! âˆ· a} = âˆ·-congáµ£ vğ“

        unique : âˆ€ {Î´ : ğ”—ğ”ª Î” (Î“ Â· A)} {Î³ : ğ”—ğ”ª Î” Î“} {a : ğ”—ğ”ª Î” (ğŸ™ Â· A)}
                 â†’ Ï€ id âˆ˜ Î´ S.â‰ˆ Î³ â†’ ! âˆ· ğ“ [ Î´ ] S.â‰ˆ a â†’ âŸ¨ Î³ , a âŸ© S.â‰ˆ Î´
        unique {Î´ = Î´ âˆ· b} {a = ! âˆ· a} pâ‚ pâ‚‚ =
          âˆ·-congâ‚‚ (S.trans (S.sym pâ‚) projectâ‚)
                  (C.trans (C.sym (ğ’µ-cong pâ‚‚)) vğ“)

CCC : ContextualCartesianClosed ğ’°
CCC = record
  { cartesian = CC
  ; Î› = Î» t â†’ ! âˆ· Î› (ğ’µ t)
  ; eval = eval
  ; Î² = Î²
  ; unique = unique
  }
  where open C.â‰ˆ-Reasoning

        eval : ğ”—ğ”ª (ğŸ™ Â· A â‡’ B Â· A) (ğŸ™ Â· B)
        eval = ! âˆ· p ğ“ â¦… ğ“ â¦†

        ğ”¼ : âˆ€ (f : ğ”—ğ”ª (Î” Â· A) (ğŸ™ Â· B)) â†’ ğ”—ğ”ª (Î” Â· A) (ğŸ™ Â· A â‡’ B Â· A)
        ğ”¼ f = ! âˆ· (Î› (ğ’µ f) [ Ï€ id ]) âˆ· ğ“

        Î² : âˆ€ (f : ğ”—ğ”ª (Î” Â· A) (ğŸ™ Â· B))
            â†’ eval âˆ˜ ğ”¼ f S.â‰ˆ f
        Î² (! âˆ· f) = âˆ·-congáµ£ (begin
            p ğ“ â¦… ğ“ â¦† [ ğ”¼ (! âˆ· f) ]
          â‰ˆâŸ¨ sb-app âŸ©
            (p ğ“ [ ğ”¼ (! âˆ· f) ]) â¦… ğ“ [ ğ”¼ (! âˆ· f) ] â¦†
          â‰ˆâŸ¨ app-congâ‚‚ (C.trans (C.trans vp vğ“) sb-lam) vğ“ âŸ©
            Î› (f [ â†‘[ Ï€ id ] ]) â¦… ğ“ â¦†
          â‰ˆâŸ¨ Î›Î² âŸ©
            f [ â†‘[ Ï€ id ] ] [ id âˆ· ğ“ ]
          â‰ˆâŸ¨ sb-assoc âŸ©
            f [ Ï€ (Ï€ id) âˆ˜ (â†‘[ id ] âˆ· ğ“) âˆ· (ğ“ [ â†‘[ id ] âˆ· ğ“ ]) ]
          â‰ˆâŸ¨ sb-congáµ£ (âˆ·-congâ‚‚ (S.trans (S.trans Ï€Î² Ï€Î²) âˆ˜-identityË¡) vğ“) âŸ©
            f [ id ]
          â‰ˆâŸ¨ sb-id âŸ©
            f
          âˆ)

        unique : âˆ€ {f : ğ”—ğ”ª (Î“ Â· A) (ğŸ™ Â· B)} {h : ğ”—ğ”ª Î“ (ğŸ™ Â· A â‡’ B)}
                 â†’ eval âˆ˜ (h âˆ˜ Ï€ id âˆ· ğ“) S.â‰ˆ f
                 â†’ h S.â‰ˆ ! âˆ· Î› (ğ’µ f)
        unique {f = ! âˆ· f} {h = ! âˆ· h} x = âˆ·-congáµ£ (begin
            h
          â‰ˆâŸ¨ Î›Î· âŸ©
            Î› (h [ Ï€ id ] â¦… ğ“ â¦†)
          â‰ˆâŸ¨ C.sym(Î›-cong (C.trans sb-app (app-congâ‚‚ (C.trans vp vğ“) vğ“))) âŸ©
            Î› (p ğ“ â¦… ğ“ â¦† [ ! âˆ· h [ Ï€ id ] âˆ· ğ“ ])
          â‰ˆâŸ¨ Î›-cong (ğ’µ-cong x) âŸ©
            Î› f
          âˆ)
